<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>The Official Radare Blog  | Loading iOS binaries</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="generator" content="Hugo 0.58.3" />
    
    
      <META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">
    

    
    
      <link href="/dist/css/app.d98f2eb6bcd1eaedb7edf166bd16af26.css" rel="stylesheet">
    

    

    
      
    

    

    <meta property="og:title" content="Loading iOS binaries" />
<meta property="og:description" content="There are several posts explaining the process to decrypt an iOS app, this is not new, but no one explained the instruction to do it with r2.
We have no aim in promoting piracy or cracking, but that&rsquo;s the only way to analyze applications from the AppleStore.
Retrieving information First of all you need a jailbroken device, in Cydia add the cydia.radare.org repository, in order to get the latest radare2 package from there." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://radare.today/posts/loading-ios-binaries/" />
<meta property="article:published_time" content="2014-05-19T02:02:01+02:00" />
<meta property="article:modified_time" content="2014-05-19T02:02:01+02:00" />
<meta itemprop="name" content="Loading iOS binaries">
<meta itemprop="description" content="There are several posts explaining the process to decrypt an iOS app, this is not new, but no one explained the instruction to do it with r2.
We have no aim in promoting piracy or cracking, but that&rsquo;s the only way to analyze applications from the AppleStore.
Retrieving information First of all you need a jailbroken device, in Cydia add the cydia.radare.org repository, in order to get the latest radare2 package from there.">


<meta itemprop="datePublished" content="2014-05-19T02:02:01&#43;02:00" />
<meta itemprop="dateModified" content="2014-05-19T02:02:01&#43;02:00" />
<meta itemprop="wordCount" content="604">



<meta itemprop="keywords" content="" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Loading iOS binaries"/>
<meta name="twitter:description" content="There are several posts explaining the process to decrypt an iOS app, this is not new, but no one explained the instruction to do it with r2.
We have no aim in promoting piracy or cracking, but that&rsquo;s the only way to analyze applications from the AppleStore.
Retrieving information First of all you need a jailbroken device, in Cydia add the cydia.radare.org repository, in order to get the latest radare2 package from there."/>

  </head>

  <body class="ma0 avenir bg-near-white">

    
   
  

  <header>
    <div class="bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="https://radare.today" class="f3 fw2 hover-white no-underline white-90 dib">
      The Official Radare Blog
    </a>
    <div class="flex-l items-center">
      

      
      



<a href="radareorg" target="_blank" class="link-transition twitter link dib z-999 pt3 pt0-l mr1" title="Twitter link" rel="noopener" aria-label="follow on Twitter——Opens in a new window">
  <svg height="32px"  style="enable-background:new 0 0 67 67;" version="1.1" viewBox="0 0 67 67" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167,22.283c-2.619,0.953-4.274,3.411-4.086,6.101  l0.063,1.038l-1.048-0.127c-3.813-0.487-7.145-2.139-9.974-4.915l-1.383-1.377l-0.356,1.017c-0.754,2.267-0.272,4.661,1.299,6.271  c0.838,0.89,0.649,1.017-0.796,0.487c-0.503-0.169-0.943-0.296-0.985-0.233c-0.146,0.149,0.356,2.076,0.754,2.839  c0.545,1.06,1.655,2.097,2.871,2.712l1.027,0.487l-1.215,0.021c-1.173,0-1.215,0.021-1.089,0.467  c0.419,1.377,2.074,2.839,3.918,3.475l1.299,0.444l-1.131,0.678c-1.676,0.976-3.646,1.526-5.616,1.568  C19.775,43.256,19,43.341,19,43.405c0,0.211,2.557,1.397,4.044,1.864c4.463,1.377,9.765,0.783,13.746-1.568  c2.829-1.673,5.657-5,6.978-8.221c0.713-1.716,1.425-4.851,1.425-6.354c0-0.975,0.063-1.102,1.236-2.267  c0.692-0.678,1.341-1.419,1.467-1.631c0.21-0.403,0.188-0.403-0.88-0.043c-1.781,0.636-2.033,0.551-1.152-0.402  c0.649-0.678,1.425-1.907,1.425-2.267c0-0.063-0.314,0.042-0.671,0.233c-0.377,0.212-1.215,0.53-1.844,0.72l-1.131,0.361l-1.027-0.7  c-0.566-0.381-1.361-0.805-1.781-0.932C39.766,21.902,38.131,21.944,37.167,22.283z M33,64C16.432,64,3,50.569,3,34S16.432,4,33,4  s30,13.431,30,30S49.568,64,33,64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/></svg>

<span class="new-window"><svg  height="8px"  style="enable-background:new 0 0 1000 1000;" version="1.1" viewBox="0 0 1000 1000" width="8px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M598 128h298v298h-86v-152l-418 418-60-60 418-418h-152v-86zM810 810v-298h86v298c0 46-40 86-86 86h-596c-48 0-86-40-86-86v-596c0-46 38-86 86-86h298v86h-298v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/>
</svg>
</span></a>









    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">

    <header class="mt4 w-100">
      <p class="f6 b helvetica tracked">
          
        POSTS
      </p>
      <h1 class="f1 athelas mb1">Loading iOS binaries</h1>
      
      <time class="f6 mv4 dib tracked" datetime="2014-05-19T02:02:01&#43;02:00">May 19, 2014</time>
      
      
    </header>

    <section class="nested-copy-line-height lh-copy serif f4 nested-links nested-img mid-gray pr4-l w-two-thirds-l">

<p>There are several posts explaining the process to decrypt an iOS app, this is not new, but no one explained the instruction to do it with r2.</p>

<p>We have no aim in promoting piracy or cracking, but that&rsquo;s the only way to analyze applications from the AppleStore.</p>

<h2 id="retrieving-information">Retrieving information</h2>

<p>First of all you need a jailbroken device, in <a href="http://cydia.saurik.com/">Cydia</a> add the <code>cydia.radare.org</code> repository, in order to get the latest radare2 package from there. Once installed, ssh into the device and type the following commands to retrieve the encryption information stored in the MACH0 header.</p>

<pre><code>$ export APP=/var/mobile/Applications/*/Target.app/Target
$ rabin2 -k 'info/*' $APP
uuid.0=034324c306b633909dbd0f229ceae7c9
crypto=true
cryptid=0x1
cryptoff=0x4000
cryptsize=0x6e4000
</code></pre>

<p>At the moment, only few information are stored in SDB, but this will change during next months. You may also access this information from the r2 shell this way:</p>

<pre><code>$ r2 $APP
[0x00004320]&gt; k bin/cur/info/*
</code></pre>

<p>Let&rsquo;s create a simple r2 script to add two flags to store <em>cryptoff</em> and *cryptsiz*e variables that we may use later for dumping and patching.</p>

<pre><code>$ cat &gt; bin.r2 &lt;&lt;EOF
f cryptoff=0x4000
f cryptsize=0x6e4000
EOF
</code></pre>

<p>Dumping the memory from the debugger can be done with the following commands:</p>

<pre><code>$ r2 -i bin.r2 -d $APP
[0x2be78028]&gt; dm
sys 0x00000000 - 0x00001000 s --- --- 00 share/priv/not-reserved
sys 0x0002d000 - 0x00031000 s r-x r-x 01 copy/priv/not-reserved
sys 0x00031000 - 0x00715000 s r-x r-x 02 copy/priv/not-reserved
sys 0x00715000 - 0x00889000 s rw- rw- 03 copy/priv/not-reserved
sys 0x00889000 - 0x0088d000 s rw- rw- 04 copy/priv/not-reserved
sys 0x0088d000 - 0x00909000 s r-- r-- 05 copy/priv/not-reserved
sys 0x27cd7000 - 0x27cd8000 s --- rwx 06 copy/priv/not-reserved
sys 0x27cd8000 - 0x27dd7000 s rw- rwx 07 copy/priv/not-reserved
sys 0x2be77000 * 0x2be98000 s r-x r-x 08 copy/priv/not-reserved
sys 0x2be98000 - 0x2be99000 s rw- rw- 09 copy/priv/not-reserved
sys 0x2be99000 - 0x2bec1000 s rw- rw- 0a copy/priv/not-reserved
sys 0x2bec1000 - 0x2becf000 s r-- r-- 0b copy/priv/not-reserved
sys 0x2c000000 - 0x3c000000 s r-- rwx 0c share/priv/reserved
sys 0x3c000000 - 0x40000000 s r-- rwx 0d share/priv/reserved
[0x2be78028]&gt; s `dm~r-x:0[1]`
[0x00040000]&gt; s+cryptoff
[0x00044000]&gt; wt dump.bin cryptsize
dumped 0x6e4000 bytes
</code></pre>

<h2 id="patching-the-binary">Patching the binary</h2>

<p>Once we get the dump we will want to patch the program. We will ignore the <em>RBin</em> information (<code>-n</code>) and enable the write mode option (<code>-w</code>). This will load the file in &lsquo;<em>raw</em>&rsquo; and we will patch with the decrypted block.</p>

<pre><code>$ cp -f $APP bin
$ r2 -i bin.r2 -nw bin
[0x00000000]&gt; wf dump.bin @ cryptoff
</code></pre>

<p>We will have to patch the binary to mark it as unencrypted. Setting <code>cryptid</code> to <strong>0</strong>.</p>

<pre><code>[0x00000000]&gt; /v cryptsize
[0x00000000]&gt; s hit0_0+4
[0x00000a08]&gt; wx 00
</code></pre>

<h2 id="loading-objective-c-metadata">Loading Objective-C metadata</h2>

<p>Most iOS apps are written in ObjC, and all the symbolic information are stored there, this is very useful to understand the app workflow and design.</p>

<p>At the moment, the way to load ObjC information into radare2 is by using the <code>objc.pl</code> script which makes uses of <code>class-dump</code>.</p>

<pre><code>$ ~/radare2/doc/objc.pl bin &gt; bin.objc.r2

</code></pre>

<p>Or directly from the r2 shell</p>

<pre><code>[0x00004000]&gt; .!./objc.pl $FILE

</code></pre>

<h2 id="extracting-sub-bins">Extracting sub-bins:</h2>

<p>As a final note, just say that you may find iOS apps in MACH0 or FATMACH0 formats, in the last case we will be interested in extracting and analyzing only the one that fits best to our needs.</p>

<p>For example, inside a FATMACH0 iOS app you can find ARMv6, ARMv7 and ARM64 executables. The tool <code>rabin2</code> can be used to list all sub-binaries contained inside a FATMACH0 file using the <code>-A</code> flag:</p>

<pre><code>$ rabin2 -A bin
</code></pre>

<p>Also we can use the <code>-x</code> flag to extract them all.</p>

<pre><code>$ rabin2 -x bin
</code></pre>

<p>Or we may need to specify which sub-bin we want to load by using the <code>r2 -a &lt;arch&gt; -b &lt;bits&gt;</code> flags when loading a FATMACH0.</p>
<ul class="pa0">
  
</ul>
<div class="mt6">
      
      
      </div>
    </section>

    <aside class="w-30-l mt6-l">




</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="https://radare.today" >
    &copy; 2019 The Official Radare Blog
  </a>
    <div>



<a href="radareorg" target="_blank" class="link-transition twitter link dib z-999 pt3 pt0-l mr1" title="Twitter link" rel="noopener" aria-label="follow on Twitter——Opens in a new window">
  <svg height="32px"  style="enable-background:new 0 0 67 67;" version="1.1" viewBox="0 0 67 67" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167,22.283c-2.619,0.953-4.274,3.411-4.086,6.101  l0.063,1.038l-1.048-0.127c-3.813-0.487-7.145-2.139-9.974-4.915l-1.383-1.377l-0.356,1.017c-0.754,2.267-0.272,4.661,1.299,6.271  c0.838,0.89,0.649,1.017-0.796,0.487c-0.503-0.169-0.943-0.296-0.985-0.233c-0.146,0.149,0.356,2.076,0.754,2.839  c0.545,1.06,1.655,2.097,2.871,2.712l1.027,0.487l-1.215,0.021c-1.173,0-1.215,0.021-1.089,0.467  c0.419,1.377,2.074,2.839,3.918,3.475l1.299,0.444l-1.131,0.678c-1.676,0.976-3.646,1.526-5.616,1.568  C19.775,43.256,19,43.341,19,43.405c0,0.211,2.557,1.397,4.044,1.864c4.463,1.377,9.765,0.783,13.746-1.568  c2.829-1.673,5.657-5,6.978-8.221c0.713-1.716,1.425-4.851,1.425-6.354c0-0.975,0.063-1.102,1.236-2.267  c0.692-0.678,1.341-1.419,1.467-1.631c0.21-0.403,0.188-0.403-0.88-0.043c-1.781,0.636-2.033,0.551-1.152-0.402  c0.649-0.678,1.425-1.907,1.425-2.267c0-0.063-0.314,0.042-0.671,0.233c-0.377,0.212-1.215,0.53-1.844,0.72l-1.131,0.361l-1.027-0.7  c-0.566-0.381-1.361-0.805-1.781-0.932C39.766,21.902,38.131,21.944,37.167,22.283z M33,64C16.432,64,3,50.569,3,34S16.432,4,33,4  s30,13.431,30,30S49.568,64,33,64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/></svg>

<span class="new-window"><svg  height="8px"  style="enable-background:new 0 0 1000 1000;" version="1.1" viewBox="0 0 1000 1000" width="8px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M598 128h298v298h-86v-152l-418 418-60-60 418-418h-152v-86zM810 810v-298h86v298c0 46-40 86-86 86h-596c-48 0-86-40-86-86v-596c0-46 38-86 86-86h298v86h-298v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/>
</svg>
</span></a>








</div>
  </div>
</footer>

    

  <script src="/dist/js/app.3fc0f988d21662902933.js"></script>


  </body>
</html>
